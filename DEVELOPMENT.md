# SortSnap 開発経過記録

## プロジェクト概要

画像ファイルを視覚的に並べ替え、統一された命名規則で一括リネーム・保存するクロスプラットフォーム対応のGUIツール

## 開発環境

- **言語**: Python 3.10+
- **GUIフレームワーク**: PyQt6 6.6.1
- **画像処理**: Pillow 10.2.0
- **パッケージング**: PyInstaller 6.3.0
- **アーキテクチャ**: MVC (Model-View-Controller)

## 開発履歴

### 2025-10-06: 初期実装完了

#### 実装内容

1. **プロジェクト構造の構築**
   - MVCアーキテクチャに基づいたディレクトリ構造
   - models/、controllers/、views/、utils/ の分離

2. **モデル層 (Models)**
   - `ImageModel`: 画像データ管理、サムネイル生成
   - `ConfigModel`: 設定の永続化（JSON）
   - `HistoryModel`: Undo/Redo履歴管理（最大50段階）

3. **コントローラー層 (Controllers)**
   - `ImageController`: 画像読み込み、並べ替え、削除、ソート
   - `RenameController`: ファイル名生成、検証、サンプル表示
   - `FileController`: ファイル保存、フォルダ作成、PNG→JPG変換

4. **ビュー層 (Views)**
   - `MainWindow`: メインウィンドウ、メニューバー、ショートカット
   - `SettingsPanel`: 設定パネル（モード選択、リネーム設定、JPG変換）
   - `PreviewArea`: 画像プレビューエリア、サムネイルグリッド表示

5. **ユーティリティ (Utils)**
   - `constants.py`: アプリケーション定数
   - `logger.py`: ログ管理（ローテーション機能付き）
   - `validator.py`: ファイル名検証、不正文字チェック
   - `animation.py`: アニメーション再生機能

6. **その他**
   - `main.py`: アプリケーションエントリーポイント
   - `requirements.txt`: 依存関係定義
   - `README.md`: ユーザーマニュアル
   - `.gitignore`: Git除外設定
   - `animations/animations.csv`: アニメーション定義

#### 実装済み機能

✅ **基本機能**
- フォルダから画像読み込み（.jpg, .jpeg, .png）
- サムネイル表示（グリッドレイアウト）
- サムネイルサイズ調整（100px〜400px）
- ファイル名順ソート（昇順/降順）
- 元の順序に戻す機能

✅ **リネーム機能**
- 連番のみ: `001.jpg`, `002.jpg`
- テキスト + 連番: `MyImage_001.jpg`
- 日付 + 連番: `251006_001.jpg` (YYMMDD形式)
- リアルタイムサンプル表示
- ファイル名検証（不正文字、予約語チェック）

✅ **編集機能**
- Undo/Redo（最大50段階）
- 削除機能（複数選択対応）
- 画像クリックイベント

✅ **保存機能**
- リネーム保存
- PNG → JPG変換（品質調整可能）
- 保存確認ダイアログ
- エラーハンドリング

✅ **設定管理**
- config.jsonで設定永続化
- ウィンドウサイズ・位置の記憶
- 前回のフォルダパス復元
- リネーム設定の保存

✅ **ログ機能**
- 起動・終了ログ
- 処理内容の記録
- エラーログ（スタックトレース付き）
- ログローテーション（最新30件保持）

✅ **UI/UX**
- メニューバー（ファイル、編集、ヘルプ）
- キーボードショートカット
- レスポンシブレイアウト
- スタイルシート適用

#### 未実装・簡略化した機能

⚠️ **ダイアログ**
- PreviewDialog（画像拡大表示）: 未実装
- ProgressDialog（保存進捗表示）: 未実装
- SplashScreen（起動画面）: 未実装

⚠️ **高度な機能**
- ドラッグ&ドロップによる並べ替え: 基本クリックのみ実装
- 複数選択（Ctrl+クリック、範囲選択）: 未実装
- 新規フォルダ作成モード: UI準備済みだが未完成
- アニメーション表示: フレーム画像が必要

⚠️ **その他**
- 非同期画像読み込み（QThread）: 未実装
- プログレスバー付き保存: 基本保存のみ実装

## プロジェクト構造

```
SortSnap/
├── main.py                       # メインエントリーポイント
├── requirements.txt              # 依存関係
├── README.md                     # ユーザーマニュアル
├── DEVELOPMENT.md                # 開発経過記録（本ファイル）
├── .gitignore                   # Git除外設定
│
├── src/
│   ├── __init__.py
│   │
│   ├── models/                  # データモデル層
│   │   ├── __init__.py
│   │   ├── image_model.py       # 画像データ管理
│   │   ├── config_model.py      # 設定管理
│   │   └── history_model.py     # Undo/Redo履歴
│   │
│   ├── controllers/             # ビジネスロジック層
│   │   ├── __init__.py
│   │   ├── image_controller.py  # 画像操作
│   │   ├── rename_controller.py # リネーム処理
│   │   └── file_controller.py   # ファイル操作
│   │
│   ├── views/                   # UI層
│   │   ├── __init__.py
│   │   ├── main_window.py       # メインウィンドウ
│   │   ├── settings_panel.py    # 設定パネル
│   │   └── preview_area.py      # プレビューエリア
│   │
│   ├── utils/                   # ユーティリティ
│   │   ├── __init__.py
│   │   ├── constants.py         # 定数定義
│   │   ├── logger.py            # ログ管理
│   │   ├── validator.py         # ファイル名検証
│   │   └── animation.py         # アニメーション再生
│   │
│   └── resources/               # リソース
│       ├── icons/               # アイコン（未実装）
│       └── styles/              # スタイルシート（未実装）
│
├── animations/                  # アニメーション
│   ├── animations.csv           # アニメーション定義
│   └── frames/                  # フレーム画像格納用
│       ├── splash_001.png 〜 030 (未作成)
│       └── idle_001.png 〜 060 (未作成)
│
└── logs/                        # ログフォルダ（実行時生成）
    └── sortsnap_log_*.txt
```

## セットアップ手順

### 1. 仮想環境の作成

```bash
python -m venv venv
```

### 2. 仮想環境のアクティベート

**Windows:**
```bash
venv\Scripts\activate
```

**macOS/Linux:**
```bash
source venv/bin/activate
```

### 3. 依存関係のインストール

```bash
pip install -r requirements.txt
```

### 4. アプリケーションの起動

```bash
python main.py
```

## 次の開発ステップ

### Phase 2: 基本機能の完成

1. **ドラッグ&ドロップ実装**
   - サムネイルのドラッグ開始検出
   - ドロップ位置の視覚的フィードバック
   - 画像順序の入れ替え処理

2. **複数選択機能**
   - Ctrl+クリックで個別選択
   - Shift+クリックで範囲選択
   - 選択状態の視覚的表示

3. **ダイアログ実装**
   - PreviewDialog: 画像拡大表示、ズーム、前後移動
   - ProgressDialog: 保存進捗、残り時間表示、キャンセル機能
   - SplashScreen: 起動時のアニメーション

### Phase 3: 高度な機能

1. **新規フォルダ作成モード**
   - ファイルドラッグ&ドロップ受付
   - 新規フォルダ作成処理
   - 重複チェック

2. **非同期処理**
   - QThreadによる画像読み込み
   - プログレスバー表示
   - UI応答性の向上

3. **アニメーション**
   - フレーム画像の作成
   - スプラッシュスクリーン実装
   - 待機中アニメーション

### Phase 4: 最適化・仕上げ

1. **パフォーマンス最適化**
   - サムネイルキャッシュ
   - メモリ管理
   - 大量画像対応（1,000枚以上）

2. **テスト**
   - ユニットテスト作成
   - 統合テスト
   - 実機テスト（Windows/macOS）

3. **ビルド・配布**
   - PyInstallerで実行ファイル作成
   - アイコン設定
   - インストーラー作成（オプション）

## 既知の問題

1. **アニメーション**: フレーム画像が未作成のため、アニメーション機能は動作しない
2. **ドラッグ&ドロップ**: クリック選択のみ、並べ替えは未実装
3. **プレビュー**: 拡大表示ダイアログが未実装
4. **保存進捗**: プログレスバーなし、同期処理のみ

## 技術的な決定事項

### アーキテクチャ
- **MVCパターン**: モデル・ビュー・コントローラーの明確な分離
- **シグナル/スロット**: PyQt6のシグナル機構を活用した疎結合設計

### データ永続化
- **config.json**: 設定の保存形式
- **履歴管理**: メモリ内でのUndoスタック（最大50段階）

### 画像処理
- **Pillow**: サムネイル生成、PNG→JPG変換
- **PyQt6 QPixmap**: UI表示用

### ログ
- **標準logging**: Pythonの標準ライブラリ使用
- **ローテーション**: 最新30件のログファイルを保持

## 参考資料

- 要件定義書: `SortSnap_要件定義書_v2.0.md`
- 技術要件定義書: `SortSnap_技術要件定義書_v1.0.md`
- PyQt6ドキュメント: https://www.riverbankcomputing.com/static/Docs/PyQt6/
- Pillowドキュメント: https://pillow.readthedocs.io/

## 開発者メモ

### 重要なファイル
- `src/controllers/image_controller.py`: 画像操作の中心的なロジック
- `src/views/main_window.py`: アプリケーションのメインエントリ
- `src/models/config_model.py`: 設定の永続化機構

### カスタマイズポイント
- `src/utils/constants.py`: デフォルト値の変更
- `src/views/settings_panel.py`: UI設定項目の追加
- `src/controllers/rename_controller.py`: リネームテンプレートの追加

## 連絡先・引き継ぎ事項

このプロジェクトを引き継ぐ場合:

1. **DEVELOPMENT.md（本ファイル）を確認**: 開発経過と現状把握
2. **要件定義書を確認**: 実装すべき機能の全体像把握
3. **README.mdを確認**: ユーザー視点での機能確認
4. **次の開発ステップを参照**: 未実装機能の優先順位確認

### 現時点での動作状況
- ✅ アプリケーション起動可能
- ✅ フォルダから画像読み込み可能
- ✅ サムネイル表示可能
- ✅ リネーム設定変更可能
- ✅ 保存機能動作（基本機能）
- ⚠️ 並べ替えは未実装（クリック選択のみ）
- ⚠️ アニメーションは画像未作成で非表示

---

**最終更新**: 2025-10-06
**ステータス**: Phase 1完了、Phase 2開始準備完了
